rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    function isVerifiedUser() {
      return request.auth != null && request.auth.token.email_verified == true;
    }
    
    match /tasks/{taskId} {
      allow read: if isVerifiedUser() && resource.data.uid == request.auth.uid;
      allow create: if isVerifiedUser() && 
                      request.resource.data.uid == request.auth.uid &&
                      request.resource.data.keys().hasAll(['uid', 'text', 'due', 'status']) &&
                      request.resource.data.priority in ['low', 'medium', 'high', 'urgent'] &&
                      request.resource.data.reminderSent == false;
      allow update: if isVerifiedUser() && resource.data.uid == request.auth.uid;
      allow delete: if isVerifiedUser() && resource.data.uid == request.auth.uid;
    }
  }
}
